<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>movies.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>movies.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <h1>Description</h1>
<p>Command Line Tool for Movie Project of
the Udacity Full Stack Web Developer Nano Degree</p>
<p>With this Programm it is possible to search for Movies and add them 
to a Favorites Databse. The whole Programm works from your commandline.</p>
<p>Once you are done collecting your videos you can hit the "s" key 
(for show) and a stand alone HTML Page will be generated with 
the content of the DB. Media Resources will be fetched from the web.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <h1>License</h1>
<p>This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <h1>Author</h1>
<p>ToM Krickl</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <h1>Date</h1>
<p>Last Update 18 May 2015</p>
<p>Please see GitHub changelog</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <h1>Technical</h1>
<ol>
<li>When called from the Commandline the Program is looking for a db in the, 
local folder. If it does not exist it creates one and generates the table
needed.</li>
<li>The Programm goes into the main communication loop, lists the main usage
paramenters and waits for a input.</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <h3>input is a movie name</h3>
<ol>
<li>with the input a GET request is sent to omdbapi.com and the result is
displayed to the user for selection.</li>
<li>the id of the selection is used to send another GET request to collect
the whole data from omdbapi</li>
<li>the movie trailer is collected form youtube by selecting the first 
search result with a regex expression. to get the right trailer 
"official trailer" is added to the movies title for search</li>
<li>the later needed data is stored to the db. </li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <h3>input is l &gt; LIST</h3>
<p>a list of all entries in the database is printed out to the commandline</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <h3>input is d &gt; DELETE</h3>
<p>a list of all entries is printed to the commandline. the user can select
one of the entries to delete it.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <h3>input is q &gt; QUIT</h3>
<p>the program breaks the main communication loop, closes the connection to 
the database and ends</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <h3>input is s &gt; SHOW</h3>
<p>all data is fetched from the db as a list of dicts, converted into a list
of movie objects and then sent to the fresh_tomatoes.py (provided by 
Udacity) to generate a html page from the content. 
this html page is then opend in your web browser</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <h1>main program</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Import Modules</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">fresh_tomatoes</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Setup program wide variables</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">omdb</span> <span class="o">=</span> <span class="s">&quot;http://www.omdbapi.com/&quot;</span>
<span class="n">youtube</span> <span class="o">=</span> <span class="s">&quot;https://www.youtube.com/&quot;</span>
<span class="n">imdb</span> <span class="o">=</span> <span class="s">&quot;http://www.imdb.com/&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <h2>serach</h2>
<p>Send GET request to URL with Parameters in dic_query
if response is json you can get a dict from it back by setting 
return_dict to True</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">search</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">dic_query</span><span class="p">,</span><span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;search (url,dic_query[,return_dict=False])</span>

<span class="sd">	sends a GET request to the url and returns the fetched data.</span>
<span class="sd">	if the response is a json you can set return_dict True to convert</span>
<span class="sd">	the response to a python dictionary</span>

<span class="sd">	url: the url to connect to </span>
<span class="sd">		e.g.: https://www.youtube.com/result</span>
<span class="sd">	dic_query: the GET parameters to be sent e.g.: </span>
<span class="sd">		s = what to search &gt; {&quot;s&quot;:&quot;what to search&quot;}</span>
<span class="sd">	return_dict: if the feedback from the website is a json</span>
<span class="sd">		you can get back a dict if you set this to true.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="s">&quot;?&quot;</span><span class="o">+</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">dic_query</span><span class="p">))</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="n">search</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>generate dict from json result and return it</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <h2>main communication loop</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">user_com</span><span class="p">(</span><span class="n">DB</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;main command line user communication. </span>
<span class="sd">	this schould be startet after the db is inizialised.</span>

<span class="sd">	the database must be given as object</span>
<span class="sd">	&#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>main communication look, is left if user input is q</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">USAGE: </span><span class="se">\n</span><span class="s">q to quit, </span><span class="se">\n</span><span class="s">s for show website,</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>\
				<span class="s">&#39;l for list entries, </span><span class="se">\n</span><span class="s">d for deleting items,</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>\
				<span class="s">&#39;in seach result 0 for new search</span><span class="se">\n</span><span class="s">&#39;</span>

		<span class="n">search_input</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;What movie do you like best? </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>end the programm</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">if</span> <span class="n">search_input</span> <span class="o">==</span> <span class="s">&quot;q&quot;</span><span class="p">:</span>
			<span class="k">break</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>create a list of movie objects then generate the stand alone
website with the fresh_tomatoes module</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">elif</span> <span class="n">search_input</span> <span class="o">==</span> <span class="s">&quot;s&quot;</span><span class="p">:</span>
			<span class="n">lst_movies</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
			<span class="n">movies</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lst_movies</span><span class="p">:</span>
				<span class="n">movies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
			<span class="n">fresh_tomatoes</span><span class="o">.</span><span class="n">open_movies_page</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>print a list of all entries in the database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">elif</span> <span class="n">search_input</span> <span class="o">==</span> <span class="s">&quot;l&quot;</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Movies currently in DB&quot;</span>
			<span class="n">DB</span><span class="o">.</span><span class="n">print_list</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>delete one of the entries in the database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="k">elif</span> <span class="n">search_input</span> <span class="o">==</span> <span class="s">&quot;d&quot;</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;Movies currently in DB&quot;</span>
			<span class="n">DB</span><span class="o">.</span><span class="n">print_list</span><span class="p">()</span>
			<span class="n">del_input</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span>
						<span class="s">&quot;Which one would you like to delete? 0 for none </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">del_input</span> <span class="o">!=</span> <span class="s">&quot;0&quot;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>catch of false user input</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>				<span class="k">try</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>if user input is a valid number delete the movie from db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>					<span class="n">DB</span><span class="o">.</span><span class="n">delete_entry</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">del_input</span><span class="p">))</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">IMPORTANT: Please enter only one of the ID&#39;s.</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>get the search result from omdb</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>			<span class="n">search_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;s&quot;</span><span class="p">:</span><span class="n">search_input</span><span class="p">}</span>
			<span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">omdb</span><span class="p">,</span><span class="n">search_dict</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>

			<span class="k">if</span> <span class="s">&quot;Search&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
				<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s">&quot;Search&quot;</span><span class="p">]:</span>
					<span class="k">print</span> <span class="n">count</span><span class="p">,</span> <span class="n">elem</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">],</span> <span class="n">elem</span><span class="p">[</span><span class="s">&quot;Year&quot;</span><span class="p">],</span> <span class="n">elem</span><span class="p">[</span><span class="s">&quot;Type&quot;</span><span class="p">]</span>
					<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

				<span class="n">question</span> <span class="o">=</span> <span class="s">&quot;Which movie did you mean? &quot;</span><span class="o">+</span>\
							<span class="s">&quot;Please enter the Index Number: &quot;</span>
				<span class="n">movie_selected</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">movie_selected</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>catch for false user input</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>					<span class="k">try</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>if user input is a valid number get the movie data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>						<span class="n">dic_movie</span> <span class="o">=</span> <span class="n">get_movie_data</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&quot;Search&quot;</span><span class="p">]</span>\
							<span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">movie_selected</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&quot;imdbID&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>then write the data to db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>						<span class="n">DB</span><span class="o">.</span><span class="n">new_entry</span><span class="p">(</span><span class="n">dic_movie</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">IMPORTANT: Please enter only one of&quot;</span><span class="p">,</span>\
								<span class="s">&quot;the Numbers.</span><span class="se">\n</span><span class="s">&quot;</span>
					
			<span class="k">else</span><span class="p">:</span>
				<span class="k">print</span> <span class="s">&quot;Sorry no result. Please try again.&quot;</span>
	<span class="k">return</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <h2>get movie data from ombd with the given imdbID</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_movie_data</span><span class="p">(</span><span class="n">imdbID</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;function to get movie data from the open movie database based</span>
<span class="sd">	on a given imdb id.</span>

<span class="sd">	returns a dict with a data to the movie including the youtube trailor</span>
<span class="sd">	and the imdb link.</span>
<span class="sd">	</span>
<span class="sd">	fields included are:</span>
<span class="sd">	Plot, Rated, tomatoImage, Title, DVD, tomatoMeter, Writer,</span>
<span class="sd">	tomatoUserRating, Production, Actors, tomatoFresh, Type, imdbVotes, </span>
<span class="sd">	Website, tomatoConsensus, Poster, tomatoRotten, Director, Released, </span>
<span class="sd">	tomatoUserReviews, Awards, Genre, tomatoUserMeter, imdbRating, </span>
<span class="sd">	Language, Country, BoxOffice, Runtime, tomatoReviews, imdbID, Metascore,</span>
<span class="sd">	Response, tomatoRating, Year, Trailer, imdbURL</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">search_string</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;i&quot;</span><span class="p">:</span><span class="n">imdbID</span><span class="p">,</span><span class="s">&quot;plot&quot;</span><span class="p">:</span><span class="s">&quot;short&quot;</span><span class="p">,</span><span class="s">&quot;tomatoes&quot;</span><span class="p">:</span><span class="s">&quot;true&quot;</span><span class="p">}</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">omdb</span><span class="p">,</span><span class="n">search_string</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>

	<span class="n">yt_id</span> <span class="o">=</span> <span class="n">get_trailer</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="s">&quot;Year&quot;</span><span class="p">])</span>

	<span class="n">result</span><span class="p">[</span><span class="s">&quot;Trailer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yt_id</span>
	<span class="n">result</span><span class="p">[</span><span class="s">&quot;imdbURL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">imdb</span> <span class="o">+</span><span class="s">&#39;title/&#39;</span><span class="o">+</span><span class="n">imdbID</span>

	<span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <h2>get trailer from youtube serarch result</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_trailer</span><span class="p">(</span><span class="n">movie</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;searches youtube for movie name plus &quot;trailer official&quot; and </span>
<span class="sd">	returns the id of the first search result</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">search_text</span> <span class="o">=</span> <span class="n">movie</span><span class="o">+</span><span class="s">&quot; trailer official&quot;</span>
	<span class="n">search_string</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;search_query&quot;</span><span class="p">:</span><span class="n">search_text</span><span class="p">}</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">youtube</span><span class="o">+</span><span class="s">&#39;results&#39;</span><span class="p">,</span><span class="n">search_string</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>part of youtube website we want to search for
regex search for: 
"yt-lockup-title"&gt;&lt;a href="/watch?v=GWU-xLViib0"
we want to extract the id after /watch?v=</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&quot;</span><span class="s">yt-lockup-title</span><span class="se">\&quot;</span><span class="s">\&gt;\&lt;a href=</span><span class="se">\&quot;</span><span class="s">\/watch\?v\=([\w|\d|-|_]+)</span><span class="se">\&quot;</span><span class="s">\s&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">match</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">None</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <h2>Database Class</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">db</span><span class="p">():</span>
	<span class="sd">&#39;&#39;&#39;class for the database methods.</span>
<span class="sd">	on init a database file and table will be generated if it doesn&#39;t exist. </span>

<span class="sd">	main methods are:</span>
<span class="sd">	new_entry(dic_movie) dic_movie should be generated from get_movie_data</span>
<span class="sd">		and must include: Title, Plot, Rated, Poster, Trailer, tomatoRating,</span>
<span class="sd">		imdbRating, imdbURL</span>
<span class="sd">	get_list() returns a list of movies as dictionary</span>
<span class="sd">	delete_entry(id) deletes the movie with the given id from db </span>
<span class="sd">	close() closes the connection to the database</span>
<span class="sd">	&#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <h3>db init</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span>	<span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>search current folder and if db does not exist allready, create one</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		<span class="n">create_db</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="k">for</span> <span class="n">l_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&quot;./&quot;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">l_file</span> <span class="o">==</span> <span class="s">&quot;movies.db&quot;</span><span class="p">:</span>
				<span class="n">create_db</span> <span class="o">=</span> <span class="bp">False</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;movies.db&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nextid</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="n">create_db</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;&#39;&#39;CREATE TABLE movies</span>
<span class="s">	         	(id INTEGER,</span>
<span class="s">	         	Title text, </span>
<span class="s">	         	Plot text, </span>
<span class="s">	         	Rated text, </span>
<span class="s">	         	Poster text,</span>
<span class="s">	         	Trailer text, </span>
<span class="s">	         	tomatoRating text, </span>
<span class="s">	         	imdbRating text,</span>
<span class="s">	         	imdbURL text)&#39;&#39;&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT * FROM movies&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextid</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>close the connection to the db object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>create now db entry with the given dict 
in the dict there can be much more but we just take the elements
that we want to store for later usage</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">new_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dict_movie</span><span class="p">):</span>
		<span class="n">insert</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextid</span><span class="p">,</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Plot&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Rated&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Poster&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Trailer&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;tomatoRating&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;imdbRating&quot;</span><span class="p">],</span>
			<span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;imdbURL&quot;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;INSERT INTO movies VALUES (?,?,?,?,?,?,?,?,?)&#39;</span><span class="p">,</span><span class="n">insert</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nextid</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>print a list of elements in the db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">print_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">list_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">list_entries</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&#39;#&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">elem</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>return a list of dicts of all elements in db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">db_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">()</span>
		<span class="n">list_entries</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">db_entries</span><span class="p">:</span>
			<span class="n">dic_elem</span><span class="o">=</span><span class="p">{}</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;Plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;Rated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;Poster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;Trailer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;tomatoRating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;imdbRating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
			<span class="n">dic_elem</span><span class="p">[</span><span class="s">&quot;imdbURL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
			<span class="n">list_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic_elem</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">list_entries</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>return a list of tuples of all elements in the db</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SELECT * FROM movies&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>delete the element with the given id</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">delete_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elem_id</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;DELETE FROM movies WHERE &quot;id&quot; = ?&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">elem_id</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">result</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <h2>Movie Class</h2>
<p>creates a movie object with the given dict</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">movie</span><span class="p">():</span>
	<span class="sd">&#39;&#39;&#39; just creates an object of a movie &#39;&#39;&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dict_movie</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Plot&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rated</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Rated&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">poster</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Poster&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">trailer</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;Trailer&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tomatoRating</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;tomatoRating&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imdbRating</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;imdbRating&quot;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">imdbURL</span> <span class="o">=</span> <span class="n">dict_movie</span><span class="p">[</span><span class="s">&quot;imdbURL&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>the representation of one movie object is it's id and the title </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">repr</span> <span class="o">=</span> <span class="s">&quot;#&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Title</span>
		<span class="k">return</span> <span class="nb">repr</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>if startet form command line</p>
<ol>
<li>setup database and set Index</li>
<li>start user communication</li>
<li>if finished close connection and end programm</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	<span class="n">DB</span> <span class="o">=</span> <span class="n">db</span><span class="p">()</span>
	<span class="n">user_com</span><span class="p">(</span><span class="n">DB</span><span class="p">)</span>
	<span class="n">DB</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
